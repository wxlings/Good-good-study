### **请描述：**



# 什么是进程？



# 什么是线程？



# 什么是协程？



# 它们有什么关系？各有哪些特征？



























### 进程(Process)：[百科](https://baike.baidu.com/item/%E8%BF%9B%E7%A8%8B/382503)

1.  一段程序的执行过程 （应用程序执行的副本）
2.  系统进行资源分配和调度的基本单位 
3.  进程是程序的基本执行实体 
4.  是计算机中的程序关于某数据集合上的一次运行活动 
5.  操作系统结构的基础 
6.   每一个进程都有一个自己独立的地址空间，即进程空间



进程（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是操作系统结构的基础。在早期面向进程设计的计算机结构中，进程是程序的基本执行实体；在当代面向线程设计的计算机结构中，进程是线程的容器。程序是指令、数据及其组织形式的描述，进程是程序的实体。 

- 狭义概念： 进程是正在运行的程序的实例 
- 广义定义：进程是一个具有一定独立功能的程序关于某个数据集合的一次运行活动。它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。



#### 进程组成

进程由三部分组成：

- `程序`：描述进程要完成的功能，是控制进程执行的指令集。

- `数据集合`：程序在执行时所需要的数据和工作区。

- `进程控制块`：(Program Control Block，简称PCB)，包含进程的描述信息和控制信息，是进程存在的唯一标志。

  

**例如：在Windows操作系统下任务管理器**

<img src="https://qncdn.wanshifu.com/54df2f3876b5eda515ed5bae3015c950" style="zoom: 50%;" />



默认我们打开一个APP或者启动一个桌面应用时，系统就会默认创建一个进程，来运行应用的逻辑。当然应用也可以有子进程，在Android中创建子进程是解决高内存占用的一种方式。



#### **特征：**

**动态性**：进程的实质是程序在多道程序系统中的一次执行过程，进程是动态产生，动态消亡的。

**并发性**：任何进程都可以同其他进程一起并发执行

**独立性**：进程是一个能独立运行的基本单位，同时也是系统分配资源和调度的独立单位；

**异步性**：由于进程间的相互制约，使进程具有执行的间断性，即进程按各自独立的、不可预知的速度向前推进

**结构特征**：进程由程序、数据和进程控制块三部分组成。

多个不同的进程可以包含相同的程序：一个程序在不同的数据集里就构成不同的进程，能得到不同的结果；但是执行过程中，程序不能发生改变。



**进程至少有 5 种基本状态，它们是：初始态，执行态，等待状态，就绪状态，终止状态。**



![进程生命周期]( https://qncdn.wanshifu.com/9c2d0a7d4be08564fb2d6965a098d410 )





**问： 你知道进程间通信有哪些方式么？**





### 线程（Thread）：[百科](https://baike.baidu.com/item/%E7%BA%BF%E7%A8%8B/103101)

1.  操作系统能够进行运算调度的最小单位
2.  它被包含在进程之中，是进程中的实际运作单位。 （一个进程至少有一个线程）
3.  线程是独立调度和分派的基本单位。 
4.  又被称为轻权进程或轻量级进程 
5.  线程是指进程内的一个执行单元,也是进程内的可调度实体.
6.  一个进程可以有很多线程，每条线程并行执行不同的任务。 
7.   **一个程序至少有一个进程,一个进程至少有一个线程.** 
8.  进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。

**线程内存模型：**

<img src=" https://qncdn.wanshifu.com/c13dd2258d1bc139fac25854fcb5a48c" style="zoom:150%;" />



#### 线程组成

- 线程ID、当前指令指针(PC)

- 寄存器

- 堆栈

  

#### **特征：**

1.  可并发执行，实现并发。 

2.  独立调度和分派的基本单位。 

   在一个进程中的多个线程之间，可以并发执行，甚至允许在一个进程中所有线程都能并发执行；同样，不同进程中的线程也能并发执行，充分利用和发挥了处理机与外围设备并行工作的能力。

3. 共享进程资源。

   在同一进程中的各个线程，都可以共享该进程所拥有的资源，这首先表现在：所有线程都具有相同的地址空间（进程的地址空间），这意味着，线程可以访问该地址空间的每一个虚地址；此外，还可以访问进程所拥有的已打开文件、定时器、信号量机构等。由于同一个进程内的线程共享内存和文件，所以线程之间互相通信不必调用内核。

   

用Java中创建一个线程

```java

	// 自定义线程类
    public class MyThread extends Thread{
        public void run() {
                . . .
           }
    }
	// 创建实例
    MyThread thread = new MyThread();
    // 开始执行
    thread.start();

```



**扩展思考：**

对于Js等脚本语言，并没有线程的概念，那么异步任务是怎样实现的呢 ？[看这里](https://zhuanlan.zhihu.com/p/23659122)



**用户线程和内核线程**：

开发者编码的线程是语言级别，我们暂且称为用户线程，例如在Java中的`Thread`, Object-c中的`NSThread`  ,c中的`pthread`等，可以有代码对其声明周期进行控制。

而内核线程通常指操作系统的线程，因为我们的代码在设备执行时都是指令，CPU是不能知道各个语言的线程，是CPU真正执行的线程，用户线程需要挂靠内核线程 



**线程声明周期：**

![线程声明周期](https://pic2.zhimg.com/v2-603b9c26d9441a9d52e46d88ee3f0875_r.jpg)



* 多线程是实现异步任务的根本，同样也面临数据同步的问题



**再问：多线程存在哪些问题？**  **你了解Happen before原则么？**



#### 线程与进程关系：

![](https://img2020.cnblogs.com/other/633265/202012/633265-20201211165836816-1113514597.jpg)



### 协程（coroutine )：[百科](https://baike.baidu.com/item/%E5%8D%8F%E7%A8%8B)



1. 协程也是一种程序组件。 

2.  本质上，协程是轻量级的线程 

3.  协程是一种并发设计模式 

4.  又被称为子程序、过程、方法、函数等。

5. 在主程序中可以调用子例程来执行。 

6. 协程不是进程或线程，其执行过程更类似于子例程，或者说不带返回值的函数调用。

7. 协程相对独立，有自己的上下文，但是其切换由自己控制，由当前协程切换到其他协程由当前协程来控制。

8.  协程其实可以认为是比线程更小的执行单元  为啥说他是一个执行单元，因为他自带CPU上下文。 

   

  Go、Python、[Kotlin](https://kotlinlang.org/docs/coroutines-guide.html) 都可以在语言层面上实现协程，Java 也可以通过扩展库的方式间接支持协程。 



```ko

// 创建一个协程程序
fun main() = runBlocking { // this: CoroutineScope
    launch { // launch a new coroutine and continue
        delay(1000L) // non-blocking delay for 1 second (default time unit is ms)
        println("World!") // print after delay
    }
    println("Hello") // main coroutine continues while a previous one is delayed
}

// 协程是轻量级的
fun main() = runBlocking {
    repeat(100_000) { // launch a lot of coroutines
        launch {
            delay(5000L)
            print(".")
        }
    }
}

```



**简单来说可以认为协程是线程里不同的函数，这些函数之间可以相互快速切换，协程和用户态线程非常接近**，用户态线程之间的切换不需要陷入内核，但部分操作系统中用户态线程的切换需要内核态线程的辅助。 

**协程只有和异步IO结合起来才能发挥出最大的威力。**

**Android Developer： 协程是我们在 Android 上进行异步编程的推荐解决方案。** 

**[知乎网友说协程](https://zhuanlan.zhihu.com/p/172471249)**



协程与线程与进程的关系：

![](https://tse1-mm.cn.bing.net/th/id/R-C.2a77c92fdf041910ba0484395b41ff63?rik=iBilGtJRYSdM%2fg&riu=http%3a%2f%2fwww.enmalvi.com%2fwp-content%2fuploads%2f2021%2f03%2fimage-118.png&ehk=lqTp2hxtIpUCvjYHLBK1kNsXpTAGLiwjeGxfxqX%2fJDU%3d&risl=&pid=ImgRaw&r=0)

​	

## [一起看视频](https://www.bilibili.com/video/BV1Wr4y1A7DS?spm_id_from=333.337.search-card.all.click